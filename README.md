# Validation Dataset

> This project is a work-in-progress

The goal of this project is to create a validation cohort using [BamSurgeon](https://github.com/adamewing/bamsurgeon), a tool that allows variants to be inserted into preexisting BAM files. By creating these "frankenBAM" samples, we can validate hundreds of variants within a single sample, significantly reducing both the time and computational resources required for validation purposes. 

## 1. Obtain variant list

A list of pathogenic/likely pathogenic variants previously identified in the laboratory and their metadata was generated using Crystal Reports. Resulting file is a `csv`.

## 2. Convert dataset into format compatible with BamSurgeon

In order to use these variants as our BamSurgeon input, they must be formatted as a BED file with columns: 
`chr    start   end VAF alt`

R script `modifydata.R`:
- Cleans Crystal report, removing duplicated/incomplete entries
- Extracts SNVs (removing indels which are not accepted by BamSurgeon's `addsnvs.py`)
- Outputs new `tsv` files with sample lookup details for DNAnexus and variant metadata.
- Produces separate male and female `tsv` files to enable the creation of two family trios (for accurate handling of X-linked variants).

Bash script `annotation_to_bed.sh`:
- Navigates through cloud server to locate annotation files for old samples
- Script pulls relevant info (chromosome, start coord, end coord, zygosity)
    - annotation files are either generated by VEP or Alamut depending on when the sample was analysed. VEP and Alamut annotation files have unique formats so must be handled differently. 

In the case of exomes/genomes, which are run as trios, we also require a BED file representing the mother and father. 
- for duos, the other parent is effectively assumed to match the reference genome, since the variant will not be added to the corresponding bed file. 

## 3. Running BamSurgeon (addsnv.py)

Used Dockerfile in `bamsurgeon-docker` to run BamSurgeon. 

### build image w/ github Dockerfile

`docker build --network=host -t bamsurgeon-env .`

### start docker shell (from bamsurgeon home directory)

`docker run -it -v "$(pwd)":/data bamsurgeon-env /bin/bash`

### run command

```bash
python3 /bamsurgeon/bin/addsnv.py  -v ../bamsurgeonInput.bed -f ../WGS_EX2500218_22CFV7LT4.bam --aligner mem --picardjar /picard.jar -p 8 -o output.bam -r ../genome/GCA_000001405.15_GRCh38_no_alt_analysis_set_plus_hs38d1_maskedGRC_exclusions_v2_no_chr.fasta
```

---

Project being undertaken as a component of my STP training. 
